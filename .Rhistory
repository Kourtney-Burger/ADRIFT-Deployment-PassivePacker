mutate(across(where(is.numeric), as.character))
View(deployDetails)
class(deployDetails)
colnames(deployDetails)
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
colnames(deployDetails)
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
colnames(deployDetails)
# Fix date formats
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m-%d-%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m-%d-%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m-%d-%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m-%d-%Y %H:%M:%S", tz = 'UTC')
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m-%d-%Y %H:%M", tz = 'UTC')
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
# Fix date formats
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m-%d-%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m-%d-%Y %H:%M:%S", tz = 'UTC')
# Fix date formats
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
# Fix date formats
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
colnames(deployDetails)
db <- dbConnect(SQLite(), "PassivePacker_v.4.0.3-win64/database/packageData - Copy (2).sqlite")
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
# Fix date formats
# `format =` argument -> format needs to match the way the data is currently stored (should be %m/%d/%Y %H:%M:%S)
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
# Make all data characters
deployDetails <- deployDetails %>%
mutate(across(where(is.numeric), as.character))
db <- dbConnect(SQLite(), "PassivePacker_v.4.0.3-win64/database/packageData - Copy (2).sqlite")
db <- dbConnect(SQLite(), "~/GitHub/ADRIFT-Deployment-PassivePacker/PassivePacker_v.4.0.3-win64/database")
db <- dbConnect(SQLite(), "PassivePacker_v.4.0.3-win64/database/packageData.sqlite")
db <- dbConnect(SQLite(), here("PassivePacker_v.4.0.3-win64", "database", "packageData.sqlite"))
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
# Fix date formats
# `format =` argument -> format needs to match the way the data is currently stored (should be %m/%d/%Y %H:%M:%S)
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
# Make all data characters
deployDetails <- deployDetails %>%
mutate(across(where(is.numeric), as.character))
db <- dbConnect(SQLite(), here("PassivePacker_v.4.0.3-win64", "database", "TESTADRIFT_packageData.sqlite"))
ppdt <- dbReadTable(db, "DEPLOYMENT_DATA")
dbDisconnect(db)
### Subset data
dd <- subset(deployDetails, select = c('Project', 'DeploymentID', 'Cruise'))
View(ppdt)
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
# Fix date formats
# `format =` argument -> format needs to match the way the data is currently stored (should be %m/%d/%Y %H:%M:%S)
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
# Make all data characters
deployDetails <- deployDetails %>%
mutate(across(where(is.numeric), as.character))
dd <- subset(deployDetails, select = c('Project', 'DeploymentID', 'Cruise'))
### Add required columns
dd <- dd %>%
add_column(ID = NA, SITE_OR_CRUISE = NA, PACKAGE_ID = NA, SOURCE_PATH = NA,
DESTINATION_PATH = NA, METADATA_AUTHOR = 'Kourtney Burger',
META_AUTHOR_UUID = NA, PUBLICATION_DATE = NA, PLATFORM = NA,
INSTRUMENT_TYPE = NA, INSTRUMENT_ID = NA, DEPLOYMENT_ALIAS = NA,
SITE_ALIAS = NA, DEPLOY_TIME = NA, AUDIO_START_TIME = NA,
RECOVER_TIME =NA, AUDIO_END_TIME = NA, TITLE = "California Current Ecosystems Survey - Passive Acoustics Survey",
PURPOSE = "From Report", ABSTRACT = "From Report", DATA_COMMENT = NA,
TEMP_PATH = NA, BIO_PATH = NA, OTHER_PATH = NA, DOCS_PATH = "Y:/1651_CCES_2018/Report",
CALIBRATION_PATH = NA, CREATION_TIME = NA, UPDATE_TIME = NA,
USE = 'Y', SAMPLING_DETAILS = NA, QUALITY_DETAILS = NA,
SCIENTISTS = NA, SPONSERS = NA, FUNDERS = NA, SENSORS = NA,
DEPLOYMENT_DETAILS = NA, CALIBRATION_INFO = NA, DATASET_INFO = NA,
ANCILLARY_INFO = NA)
### Reorder and rename columns
dd <- dd[, c(4,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,
26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42)]
View(dd)
colnames(dd)
View(dd)
names(dd)[2] <- "PROJECT"
names(dd)[3] <- "DEPLOYMENT_ID"
names(dd)[4] <- "SITE_CRUISE"
colnames(dd)
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
# Fix date formats
# `format =` argument -> format needs to match the way the data is currently stored (should be %m/%d/%Y %H:%M:%S)
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
# Make all data characters
deployDetails <- deployDetails %>%
mutate(across(where(is.numeric), as.character))
# Not needed unless you want to look at the passive packer data table structure
# db <- dbConnect(SQLite(), here("PassivePacker_v.4.0.3-win64", "database", "TESTADRIFT_packageData.sqlite"))
# ppdt <- dbReadTable(db, "DEPLOYMENT_DATA")
# dbDisconnect(db)
# Subset data
dd <- subset(deployDetails, select = c('Project', 'DeploymentID', 'Cruise'))
# Add required columns
dd <- dd %>%
add_column(ID = NA, SITE_OR_CRUISE = NA, PACKAGE_ID = NA, SOURCE_PATH = NA,
DESTINATION_PATH = NA, METADATA_AUTHOR = 'Kourtney Burger',
META_AUTHOR_UUID = NA, PUBLICATION_DATE = NA, PLATFORM = NA,
INSTRUMENT_TYPE = NA, INSTRUMENT_ID = NA, DEPLOYMENT_ALIAS = NA,
SITE_ALIAS = NA, DEPLOY_TIME = NA, AUDIO_START_TIME = NA,
RECOVER_TIME =NA, AUDIO_END_TIME = NA, TITLE = "California Current Ecosystems Survey - Passive Acoustics Survey",
PURPOSE = "From Report", ABSTRACT = "From Report", DATA_COMMENT = NA,
TEMP_PATH = NA, BIO_PATH = NA, OTHER_PATH = NA, DOCS_PATH = "Y:/1651_CCES_2018/Report",
CALIBRATION_PATH = NA, CREATION_TIME = NA, UPDATE_TIME = NA,
USE = 'Y', SAMPLING_DETAILS = NA, QUALITY_DETAILS = NA,
SCIENTISTS = NA, SPONSERS = NA, FUNDERS = NA, SENSORS = NA,
DEPLOYMENT_DETAILS = NA, CALIBRATION_INFO = NA, DATASET_INFO = NA,
ANCILLARY_INFO = NA)
# Reorder and rename columns
dd <- dd[, c(4,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,
26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42)]
names(dd)[2] <- "PROJECT"
names(dd)[3] <- "DEPLOYMENT_ID"
names(dd)[4] <- "SITE_CRUISE"
# Add ID Number (Primary Key)
# If no existing data, maxID is 0
oldMax <- ifelse(nrow(ppdt) == 0, 0, max(ppdt$ID))
db <- dbConnect(SQLite(), here("PassivePacker_v.4.0.3-win64", "database", "TESTADRIFT_packageData.sqlite"))
ppdt <- dbReadTable(db, "DEPLOYMENT_DATA")
dbDisconnect(db)
oldMax <- ifelse(nrow(ppdt) == 0, 0, max(ppdt$ID))
dd$ID <- (1:nrow(dd)) + oldMax
dd$PROJECT <- paste('SWFSC-',dd$PROJECT)
dd$PACKAGE_ID <- paste(dd$PROJECT,'_',dd$SITE_CRUISE,'_',dd$DEPLOYMENT_ID)
dd$PROJECT <- paste('["',dd$PROJECT,'"]')
dd$PROJECT <- gsub(" ","",dd$PROJECT)
dd$PACKAGE_ID <- gsub(" ","",dd$PACKAGE_ID)
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
# Fix date formats
# `format =` argument -> format needs to match the way the data is currently stored (should be %m/%d/%Y %H:%M:%S)
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
# Make all data characters
deployDetails <- deployDetails %>%
mutate(across(where(is.numeric), as.character))
db <- dbConnect(SQLite(), here("PassivePacker_v.4.0.3-win64", "database", "TESTADRIFT_packageData.sqlite"))
ppdt <- dbReadTable(db, "DEPLOYMENT_DATA")
dbDisconnect(db)
library(here)
library(DBI)
library(RSQLite)
library(tidyverse)
library(rjson)
library(dplyr)
library(stringr)
DepDir <- here('ADRIFT-Deployment-PassivePacker')
posixToText <- function(x) {
format(x, '%Y-%m-%dT%H:%M:%S')
}
#TEST
#posixToText(as.POSIXct("2018-11-22 08:28:24", tz='UTC'))
deployDetails <- read.csv(here("DeploymentDetailsFiles","ADRIFT_DeploymentDetails.csv"))
# Subset to remove non ADRIFT deployments (do not need to run if only packaging ADRIFT deployments)
deployDetails <- subset(deployDetails, Project == "ADRIFT")
# Subset to remove planned, incomplete, and lost drifts
names(deployDetails)[10] <- "Status"
deployDetails <- subset(deployDetails, Status == "Complete")
# Subset to remove unusable drifts (Check data and ensure it cannot be used for ANYTHING, some 'bad' data could be used for high frequency)
deployDetails <- subset(deployDetails, Quality_Category != "Unusable")
# Change soundtrap names
deployDetails[deployDetails == "ST640"] <- "SoundTrap 640"
deployDetails[deployDetails == "ST4300HF"] <- "SoundTrap 4300 High Frequency"
deployDetails[deployDetails == "ST300"] <- "SoundTrap 300"
deployDetails[deployDetails == "ST4300"] <- "SoundTrap 4300"
deployDetails[deployDetails == "ST500HF"] <- "SoundTrap 500 High Frequency"
deployDetails[deployDetails == "ST300HF"] <- "SoundTrap 300 High Frequency"
# Fix date formats
# `format =` argument -> format needs to match the way the data is currently stored (should be %m/%d/%Y %H:%M:%S)
names(deployDetails)[37] <- "Data_Start"
names(deployDetails)[38] <- "Data_End"
deployDetails$Data_Start <- as.POSIXct(deployDetails$Data_Start, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Data_End <- as.POSIXct(deployDetails$Data_End, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Deployment_Date_UTC <- as.POSIXct(deployDetails$Deployment_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
deployDetails$Recovery_Date_UTC <- as.POSIXct(deployDetails$Recovery_Date_UTC, format = "%m/%d/%Y %H:%M:%S", tz = 'UTC')
# Make all data characters
deployDetails <- deployDetails %>%
mutate(across(where(is.numeric), as.character))
db <- dbConnect(SQLite(), here("PassivePacker_v.4.0.3-win64", "database", "TESTADRIFT_packageData.sqlite"))
ppdt <- dbReadTable(db, "DEPLOYMENT_DATA")
dbDisconnect(db)
# Subset data
dd <- subset(deployDetails, select = c('Project', 'DeploymentID', 'Cruise'))
# Add required columns
# Change METADATA_AUTHOR and METADATA_AUTHOR_UUID to whoever is packaging data
# Change TITLE to full project name
dd <- dd %>%
add_column(ID = NA, SITE_OR_CRUISE = NA, PACKAGE_ID = NA, SOURCE_PATH = NA,
DESTINATION_PATH = NA, METADATA_AUTHOR = 'Kourtney Burger',
META_AUTHOR_UUID = '2a603700-144e-442c-bbb5-27c40363819a',
PUBLICATION_DATE = NA, PLATFORM = NA, INSTRUMENT_TYPE = NA,
INSTRUMENT_ID = NA, DEPLOYMENT_ALIAS = NA, SITE_ALIAS = NA,
DEPLOY_TIME = NA, AUDIO_START_TIME = NA, RECOVER_TIME =NA,
AUDIO_END_TIME = NA, TITLE = "ADRIFT In the California Current",
PURPOSE = NA, ABSTRACT = NA, DATA_COMMENT = NA, TEMP_PATH = NA,
BIO_PATH = NA, OTHER_PATH = NA, DOCS_PATH = NA, CALIBRATION_PATH = NA,
CREATION_TIME = NA, UPDATE_TIME = NA, USE = 'Y', SAMPLING_DETAILS = NA,
QUALITY_DETAILS = NA, SCIENTISTS = NA, SPONSERS = NA, FUNDERS = NA,
SENSORS = NA, DEPLOYMENT_DETAILS = NA, CALIBRATION_INFO = NA,
DATASET_INFO = NA, ANCILLARY_INFO = NA)
# Reorder and rename columns
dd <- dd[, c(4,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,
26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42)]
names(dd)[2] <- "PROJECT"
names(dd)[3] <- "DEPLOYMENT_ID"
names(dd)[4] <- "SITE_CRUISE"
# Add ID Number (Primary Key)
# If no existing data, maxID is 0
oldMax <- ifelse(nrow(ppdt) == 0, 0, max(ppdt$ID))
dd$ID <- (1:nrow(dd)) + oldMax
# Fix project and package_id fields
#(combine columns and remove spaces)
dd$PROJECT <- paste('SWFSC-',dd$PROJECT)
dd$PACKAGE_ID <- paste(dd$PROJECT,'_',dd$SITE_CRUISE,'_',dd$DEPLOYMENT_ID)
dd$PROJECT <- paste('["',dd$PROJECT,'"]')
dd$PROJECT <- gsub(" ","",dd$PROJECT)
dd$PACKAGE_ID <- gsub(" ","",dd$PACKAGE_ID)
# Dataset Description
dd$PURPOSE <- 'From Report'
dd$ABSTRACT <- 'From Report'
# Set package destination (change to appropriate file path)
dd$DESTINATION_PATH <- 'G:/'
